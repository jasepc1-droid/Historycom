<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study — Quick Review</title>
  <style>
    :root{ --bg:#f7fafc; --card:#ffffff; --muted:#64748b; --accent:#2563eb; font-family:system-ui,Segoe UI,Roboto,Arial; color-scheme: light; }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#e6eefc,#f8fbff); color:#0b1220}
    .wrap{max-width:980px;margin:36px auto;padding:28px;background:var(--card);border-radius:12px;box-shadow:0 10px 30px rgba(15,23,42,0.08)}
    header{display:flex;justify-content:space-between;align-items:center}
    h1{margin:0;font-size:1.4rem}
    p.meta{color:var(--muted);margin:6px 0 0 0}
    .content{display:grid;grid-template-columns:1fr 300px;gap:18px;margin-top:20px}
    .card{background:#fbfeff;padding:16px;border-radius:10px;border:1px solid rgba(2,6,23,0.03)}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer;text-decoration:none}
    .btn-ghost{background:transparent;border:1px solid rgba(37,99,235,0.12);color:var(--accent);padding:8px 12px;border-radius:8px}
    .hint{color:var(--muted);font-size:0.9rem;margin-top:10px}
    /* Game view styles */
    #gameView{display:none;height:100vh;width:100vw;position:fixed;inset:0;background:#000;z-index:9999;align-items:center;justify-content:center;flex-direction:column}
    #gameFrame{width:min(100%,1200px);height:min(90vh,900px);border:0;border-radius:6px;background:#111}
    .gameToolbar{width:100%;max-width:1200px;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;color:white}
    .backBtn{background:rgba(255,255,255,0.06);border:0;color:white;padding:8px 10px;border-radius:8px;cursor:pointer}
    @media (max-width:880px){ .content{grid-template-columns:1fr} #gameFrame{width:100%;height:100vh;border-radius:0} .wrap{margin:0;border-radius:0;box-shadow:none} }
  </style>
</head>
<body>
  <div class="wrap" id="studyWrap" aria-live="polite">
    <header>
      <div>
        <h1>World History — Chapter 3: Ancient Civilizations</h1>
        <p class="meta">Quick review • 20 minutes</p>
      </div>
      <div>
        <!-- main button that "takes you to the game" -->
        <button class="btn" id="goGameBtn">Take a Break — Go to Game</button>
      </div>
    </header>

    <div class="content" role="region" aria-label="Study content">
      <section class="card">
        <h2 style="margin-top:0">Study Summary</h2>
        <p>Key ideas: river valley civilizations, early writing systems, trade routes, cultural exchange. Remember to review the timeline and map.</p>

        <h3 style="margin-top:12px">Quick questions</h3>
        <ol>
          <li>Which river supported ancient Egypt?</li>
          <li>What writing system did Mesopotamia use?</li>
          <li>Name one major trade good from the Silk Road.</li>
        </ol>

        <div style="margin-top:16px">
          <button class="btn-ghost" id="openGameTab">Open game in new tab</button>
          <div class="hint">Click "Take a Break — Go to Game" to jump directly to the game. Use the Back button on the game screen to return to these notes.</div>
        </div>
      </section>

      <aside class="card">
        <h4 style="margin-top:0">Session</h4>
        <p class="meta">Focus: medium</p>
        <p style="margin-top:12px">Next: practice quiz in 10 minutes.</p>
      </aside>
    </div>
  </div>

  <!-- Fullscreen-ish game view (hidden until button click) -->
  <div id="gameView" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="gameToolbar" role="toolbar">
      <div style="display:flex;gap:12px;align-items:center">
        <button class="backBtn" id="backBtn">← Back to Study</button>
        <strong id="gameTitle" style="color:white">Cut the Rope — Game</strong>
      </div>
      <div style="color:rgba(255,255,255,0.85);font-size:0.9rem">Enjoy your break — close to return</div>
    </div>

    <!-- The iframe uses the exact src and sandbox you provided -->
    <iframe
      id="gameFrame"
      src=""
      data-src="https://historycom.netlify.app/"
      title="Cut the Rope Game"
      sandbox="allow-scripts allow-same-origin"
      loading="lazy"
    ></iframe>
  </div>

  <script>
    const goGameBtn = document.getElementById('goGameBtn');
    const openGameTab = document.getElementById('openGameTab');
    const studyWrap = document.getElementById('studyWrap');
    const gameView = document.getElementById('gameView');
    const gameFrame = document.getElementById('gameFrame');
    const backBtn = document.getElementById('backBtn');

    // When clicked, replace the visible page with the game iframe (lazy-load src)
    goGameBtn.addEventListener('click', () => {
      // set iframe src only when user chooses to go
      if (!gameFrame.src) gameFrame.src = gameFrame.dataset.src;
      // hide study content and show the game view
      studyWrap.style.display = 'none';
      gameView.style.display = 'flex';
      gameView.setAttribute('aria-hidden','false');
      // optional: set focus to iframe container for accessibility
      backBtn.focus();
      // change history so back button in browser returns (so it behaves like a navigation)
      history.pushState({view:'game'}, '', '#game');
    });

    // Open the actual game in a new tab if requested
    openGameTab.addEventListener('click', () => {
      const url = gameFrame.dataset.src || 'https://historycom.netlify.app/';
      window.open(url, '_blank', 'noopener');
    });

    // Back to study notes: hide iframe and reveal study content
    backBtn.addEventListener('click', () => {
      gameFrame.src = ''; // optional: unload the game when leaving
      gameView.style.display = 'none';
      gameView.setAttribute('aria-hidden','true');
      studyWrap.style.display = '';
      studyWrap.scrollIntoView({behavior:'smooth'});
      // remove the #game from URL
      if (location.hash === '#game') history.back();
    });

    // Handle browser Back/Forward navigation
    window.addEventListener('popstate', (e) => {
      if (location.hash === '#game') {
        // user navigated forward to game
        if (!gameFrame.src) gameFrame.src = gameFrame.dataset.src;
        studyWrap.style.display = 'none';
        gameView.style.display = 'flex';
        gameView.setAttribute('aria-hidden','false');
      } else {
        // no hash -> show study
        gameFrame.src = '';
        gameView.style.display = 'none';
        gameView.setAttribute('aria-hidden','true');
        studyWrap.style.display = '';
      }
    });

    // If user lands on page with #game already, show the game immediately
    if (location.hash === '#game') {
      if (!gameFrame.src) gameFrame.src = gameFrame.dataset.src;
      studyWrap.style.display = 'none';
      gameView.style.display = 'flex';
      gameView.setAttribute('aria-hidden','false');
    }
  </script>
</body>
</html>
